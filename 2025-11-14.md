# TO DO

- [x]  국회 데이터로 NER 평가
- [x]  NER 패키징
- [x]  OPEN AI API diariaziton 되나?

# 결과

## 국회 회의록 NER 결과

[제22대국회 제429회(정기회) 제12차 법제사법위원회(전체회의) (2025.11.06.).docx](attachment:5e1eeb1a-79fd-4473-a7a6-3fa366b3b593:제22대국회_제429회(정기회)_제12차_법제사법위원회(전체회의)_(2025.11.06.).docx)

[국회 회의록.txt](attachment:fdd4f727-0c5e-4c04-8a07-71a0165b5c44:국회_회의록.txt)

```markdown
곽규택 곽종근 권영진
**김** 김건희 김기표 김문수 김봉식 김성환 김용민 김용현
김정관 김정중 김현우 김현정 나경원 러트닉 **박**
박균택 박상용 박성훈 박안수 박은정 박준태 박지원 박혜진 블랙웰 **서** 서삼석 서영교 서일준
손인혁 송석준 신동욱 심우정 오동운 **윤** 윤석열 **이박상용** 이상민 이성윤
이은재 이은정 이진숙 이호현 장경태 전현희 정환철 젠슨황 조원철 조지호
조희대 주진우 지귀연 천대엽 최 최교진 최은옥 최재해 최혁준
최혁진 추경호 추미애 한덕수 한동훈 한성숙 **허성** 허성무 황운하
```

김 위원 등 ‘성 + 직책’ 인경우 성만 잡는다. 이 겨우 namevocab으로 용

이박상용의 경우 ‘이 박상용 ~~’ 이다.

```markdown
실제 출석 인원명단

출석 : 위원(16인) 곽규택 김기표 김용민 나경원 박균택 박은정 박지원 서영교 송석준 신동욱 이성윤 장경태 전현희 주진우 최혁진 추미애
청가 : 위원(2인) 박준태 조배숙
출석 : 전문위원 수석전문위원 정환철 전문위원 박병섭 전문위원 박혜진 전문위원 이은정
정부측 및 기타 참석자 감사원 원장 최재해 법무부 장관 정성호 고위공직자범죄수사처 처장 오동운 법제처 처장 조원철 교육부 차관 최은옥 산업통상자원부 장관 김정관 기후에너지환경부 제2차관 이호현 국토교통부 장관 김윤덕 중소벤처기업부 장관 한성숙
법원측 참석자 법원행정처 처장 천대엽
헌법재판소측 참석자 헌법재판소사무처 사무처장 손인혁
```

한계 :  국회 회의록은 STT가 아니기에 오인식된 이름이 나올 여지가 없다. 그러나 본 TASK의 경우 오인식된 이름이 존재할 확률이 높기에 여전히 고민 필요 

## NER 패키징

1. **(이름 감지):** 3번(STT) 결과에서 "민서씨", "인서씨" 등 이름 후보를 추출합니다.

INPUT : 모듈 A에서 STT 결과 (JSON)

**재영’s 전처리_Final (1) 구조 확인 : [timestamp] content 구조의  txt 파일**

```
[00:00:00.000 - 00:00:09.440] 그러면 너무 회의만 하지 말고 좀 토킹 어바웃을 해볼까요?
[00:00:09.440 - 00:00:10.240] 여유롭게
[00:00:10.240 - 00:00:14.400] 처음엔 그냥 알트 플레이팅? 지금 누른거에요?
[00:00:14.400 - 00:00:17.360] 자 재호님 말하세요
[00:00:17.360 - 00:00:19.920] 방금 강제로 20분 산책을 하다 왔습니다
[00:00:19.920 - 00:00:21.040] 강제로요?
```

txt → json  : https://colab.research.google.com/drive/1f0C-kz_kNRy26vhZtaWWKlNH1O85yIox?usp=sharing

```python
[
  {
    "text": "그러면 너무 회의만 하지 말고 좀 토킹 어바웃을 해볼까요?",
    "start": 0.0,
    "end": 9.44
  },
  {
    "text": "여유롭게",
    "start": 9.44,
    "end": 10.24
  },
  {
    "text": "처음엔 그냥 알트 플레이팅? 지금 누른거에요?",
    "start": 10.24,
    "end": 14.4
  },
  {
    "text": "자 재호님 말하세요",
    "start": 14.4,
    "end": 17.36
  },
  {
    "text": "방금 강제로 20분 산책을 하다 왔습니다",
    "start": 17.36,
    "end": 19.92
  }
]
```

OUTPUT : **1106_오후회의_final_namelist**, **1106_오후회의_name_check_transcript** ,1106_오후회의_stt_segments_with_name,1106_오후회의_name_clusters

- **1106_오후회의_final_namelist.txt**
    
    ```markdown
    고수
    리모
    민서
    상주
    재형
    지훈
    태균
    홍기
    ```
    
- **1106_오후회의_name_check_transcript.txt**
    
    ```
    [ ] '그러면 너무 회의만 하지 말고 좀 토킹 어바웃을 해볼까요?'
    [ ] '여유롭게'
    [ ] '처음엔 그냥 알트 플레이팅? 지금 누른거에요?'
    [v] '자 재호님 말하세요'
    [ ] '방금 강제로 20분 산책을 하다 왔습니다'
    [ ] '강제로요?'
    
    ...
    
    [ ] '덜 떨어지는 애 같은거 추려서 가면 좋을 것 같고,'
    [v] '사실 다 떠나서 지금 홍기님이 니모를 또 한번 어필하는걸 보고 내가 깨달은게,'
    [v] '홍기님의 의도가 아닐 수 있어요. 제 분석에 의하면,'
    [ ] '니모를 넣으면 우리 포트폴리오에,'
    [ ] '펜시해져. 뭔지 알죠?'
    ```
    
- 1106_오후회의_stt_segments_with_name.json
    
    ```
    [
      {
        "text": "그러면 너무 회의만 하지 말고 좀 토킹 어바웃을 해볼까요?",
        "start": 0.0,
        "end": 9.44,
        "name": null
      },
      {
        "text": "여유롭게",
        "start": 9.44,
        "end": 10.24,
        "name": null
      },
      {
        "text": "처음엔 그냥 알트 플레이팅? 지금 누른거에요?",
        "start": 10.24,
        "end": 14.4,
        "name": [
          "알트"
        ]
      },
      {
        "text": "자 재호님 말하세요",
        "start": 14.4,
        "end": 17.36,
        "name": [
          "재호"
        ]
      },
    ```
    
- 1106_오후회의_name_clusters.json
    
    ```
    {
      "고수": [
        "고수",
        "이고수"
      ],
      "리모": "리모",
      "민서": "민서",
      "상주": [
        "상주",
        "상준",
        "이상준"
      ],
      "재형": [
        "재형",
        "재호"
      ],
      "지훈": "지훈",
      "태균": "태균",
      "홍기": "홍기"
    }
    ```
    

https://colab.research.google.com/drive/1WOs9j9RijdEjRDN5EJcliPM98ohXsvfx?usp=sharing

## gpt-4o-transcribe-diarize

7분 음성 파일 , 동작 1분, $0.21 소요

```markdown
from openai import OpenAI

client = OpenAI(api_key=api_key)

audio_path = "/content/drive/MyDrive/1113_오전_회의.m4a"

with open(audio_path, "rb") as f:
    transcript = client.audio.transcriptions.create(
        model="gpt-4o-transcribe-diarize",
        file=f,
        response_format="diarized_json",
        chunking_strategy="auto"
    )

# 딕셔너리 형태로 접근
for segment in transcript.segments:
    print(segment["speaker"], segment["text"], segment["start"], segment["end"])
```

```markdown
**transcript.segments 결과**

[{'type': 'transcript.text.segment',
  'text': ' 아, 켜지진 않을까요?',
  'speaker': 'A',
  'start': 8.655999999999999,
  'end': 9.606,
  'id': 'seg_0'},
 {'type': 'transcript.text.segment',
  'text': ' 그래.',
  'speaker': 'A',
  'start': 10.056000000000001,
  'end': 10.606,
  'id': 'seg_1'},
 {'type': 'transcript.text.segment',
  'text': ' 어, 혹시 A단 돌고 있나요?',
  'speaker': 'B',
  'start': 15.406,
  'end': 17.206000000000003,
  'id': 'seg_2'},
 {'type': 'transcript.text.segment',
  'text': ' 오케이.',
  'speaker': 'B',
  'start': 17.656,
  'end': 18.156,
  'id': 'seg_3'},
```

```markdown
총 화자 수: 5

화자별 발화 횟수:
  A: 41회
  B: 59회
  C: 25회
  D: 1회
  @: 1회
```