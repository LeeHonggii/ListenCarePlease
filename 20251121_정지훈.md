# ê°œë°œ í™˜ê²½ íŒŒì•…(ë²„ì „ í™•ì¸)
python-mecab-kor
1.2.8
kss
6.0.6
transformers
4.57.1
accelerate
1.11.0
Levenshtein
0.27.3

# í´ë¼ìš°ë“œ í™˜ê²½ êµ¬ì„±
ê³ ì • IP : 18.204.107.68
username : ubuntu
Python 3.12.3
  
# To-Do ì½”ë“œ í†µí•©
ì™„ë£Œí•˜ì—¬ ë…¸ì…˜ì— ì—…ë¡œë“œ ì™„ë£Œ

# ê¸°ë³¸ í…œí”Œë¦¿ì— íšŒì˜ë¡ ë‹´ëŠ” í…ŒìŠ¤íŠ¸
ê¸°ë³¸ì ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ê²ƒ í™•ì¸ ì™„ë£Œ
## ê²°ê³¼ ì½”ë“œ
!pip install openai python-docx

import os
import json
from datetime import datetime
from openai import OpenAI
from docx import Document
from docx.enum.text import WD_ALIGN_PARAGRAPH

# ===============================================================
# [ì„¤ì •] API í‚¤ ë° í™˜ê²½ ì„¤ì •
# ===============================================================
os.environ["OPENAI_API_KEY"] = "ì•ˆì•Œë ¤ì¤„ê±°ì§€ë¡±"
client = OpenAI()

# ===============================================================
# [í•¨ìˆ˜ 1] GPT-4o: í…ìŠ¤íŠ¸ ë¶„ì„ ë° ë”•ì…”ë„ˆë¦¬ ìƒì„±
# ===============================================================
def analyze_transcript_to_dict(transcript):
    print("ğŸ¤– [GPT] íšŒì˜ë¡ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...")
    
    system_prompt = """
    ë„ˆëŠ” íšŒì˜ë¡ ì‘ì„± ì „ë¬¸ ë¹„ì„œì•¼. 
    ì œê³µëœ íšŒì˜ ë…¹ì·¨ë¡(Raw Text)ì„ ì½ê³ , ì›Œë“œ í…œí”Œë¦¿ì— ì±„ì›Œ ë„£ì„ ìˆ˜ ìˆëŠ” ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ì¶”ì¶œí•´ì¤˜.
    
    [ì¶”ì¶œ í‚¤(Key) ë° ì„¤ëª…]
    1. title: íšŒì˜ ì œëª© (ë‚´ìš©ì— ë§ì¶° ì ì ˆíˆ ìƒì„±)
    2. date: íšŒì˜ ë‚ ì§œ (YYYY-MM-DD í˜•ì‹, ì—†ìœ¼ë©´ ì˜¤ëŠ˜ ë‚ ì§œ)
    3. location: íšŒì˜ ì¥ì†Œ
    4. attendees: ì°¸ì„ì ëª…ë‹¨ (ì‰¼í‘œë¡œ êµ¬ë¶„)
    5. summary: íšŒì˜ ë‚´ìš© ìš”ì•½ (3~5ì¤„, ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì¥)
    6. action_items: í–¥í›„ ê³„íšì´ë‚˜ í•  ì¼ (ì¤„ë°”ê¿ˆ '\n'ì„ í¬í•¨í•œ í•˜ë‚˜ì˜ ê¸´ ë¬¸ìì—´ë¡œ ì‘ì„±)

    ë°˜ë“œì‹œ JSON í¬ë§·ìœ¼ë¡œë§Œ ì‘ë‹µí•´.
    """
    
    try:
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": transcript}
            ],
            response_format={"type": "json_object"}, # JSON ê°•ì œ ëª¨ë“œ
            temperature=0.3
        )
        
        # JSON ë¬¸ìì—´ì„ íŒŒì´ì¬ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜
        return json.loads(response.choices[0].message.content)
        
    except Exception as e:
        print(f"âŒ GPT ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return None

# ===============================================================
# [í•¨ìˆ˜ 2] Word: í…œí”Œë¦¿ ìƒì„± ë° ë°ì´í„° ì±„ìš°ê¸°
# ===============================================================
def create_word_report(filename, data_dict):
    doc = Document()
    
    # 1. (ì˜ˆì‹œìš©) í…œí”Œë¦¿ ì–‘ì‹ ë§Œë“¤ê¸° 
    # ì‹¤ì œë¡œëŠ” ê¸°ì¡´ì— ë§Œë“¤ì–´ë‘” .docx íŒŒì¼ì„ doc = Document('template.docx')ë¡œ ë¶ˆëŸ¬ì˜¤ë©´ ë©ë‹ˆë‹¤.
    head = doc.add_heading('{{TITLE}}', 0)
    head.alignment = WD_ALIGN_PARAGRAPH.CENTER
    
    table = doc.add_table(rows=3, cols=2)
    table.style = 'Table Grid'
    
    # í…Œì´ë¸” ê¸°ë³¸ ì„¸íŒ…
    table.cell(0, 0).text = 'ì¼ì‹œ'; table.cell(0, 1).text = '{{DATE}}'
    table.cell(1, 0).text = 'ì¥ì†Œ'; table.cell(1, 1).text = '{{LOCATION}}'
    table.cell(2, 0).text = 'ì°¸ì„ì'; table.cell(2, 1).text = '{{ATTENDEES}}'
    
    doc.add_paragraph('\n')
    doc.add_heading('1. ìš”ì•½ (Summary)', level=1)
    doc.add_paragraph('{{SUMMARY}}')
    
    doc.add_heading('2. í–¥í›„ ê³„íš (Action Items)', level=1)
    doc.add_paragraph('{{ACTION_ITEMS}}')
    
    # 2. ë°ì´í„° ë§¤í•‘ ë° ì¹˜í™˜ (Mapping & Replace)
    # GPTê°€ ì¤€ í‚¤(ì˜ˆ: title)ë¥¼ í…œí”Œë¦¿ í‚¤(ì˜ˆ: {{TITLE}})ë¡œ ë§¤í•‘
    mapping = {
        "{{TITLE}}": data_dict.get("title", ""),
        "{{DATE}}": data_dict.get("date", ""),
        "{{LOCATION}}": data_dict.get("location", ""),
        "{{ATTENDEES}}": data_dict.get("attendees", ""),
        "{{SUMMARY}}": data_dict.get("summary", ""),
        "{{ACTION_ITEMS}}": data_dict.get("action_items", "")
    }

    # ë³¸ë¬¸ ë° í…Œì´ë¸” ë‚´ í…ìŠ¤íŠ¸ ì¹˜í™˜
    for paragraph in doc.paragraphs:
        for key, value in mapping.items():
            if key in paragraph.text:
                paragraph.text = paragraph.text.replace(key, str(value))

    for table in doc.tables:
        for row in table.rows:
            for cell in row.cells:
                for paragraph in cell.paragraphs:
                    for key, value in mapping.items():
                        if key in paragraph.text:
                            paragraph.text = paragraph.text.replace(key, str(value))
                            
    doc.save(filename)
    print(f"ğŸ“„ íŒŒì¼ ì €ì¥ ì™„ë£Œ: {filename}")

# ===============================================================
# [ë©”ì¸ ì‹¤í–‰]
# ===============================================================
if __name__ == "__main__":
    # ì…ë ¥ ë°ì´í„° (STT ê²°ê³¼)
    stt_result = loaded_data['transcript_data']

    # 1. GPTë¡œ ë¶„ì„í•˜ì—¬ ë”•ì…”ë„ˆë¦¬ ìƒì„±
    gpt_data = analyze_transcript_to_dict(stt_result)
    
    if gpt_data:
        print("\n[GPT ì¶”ì¶œ ê²°ê³¼]")
        print(json.dumps(gpt_data, indent=2, ensure_ascii=False))

        # 2. ì›Œë“œ íŒŒì¼ ìƒì„±
        output_filename = "Meeting_Result.docx"
        create_word_report(output_filename, gpt_data)
    else:
        print("ë°ì´í„° ì¶”ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")