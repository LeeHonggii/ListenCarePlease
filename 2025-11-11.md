#Task 이해
- DC/HPF
    - DC offset 제거 : 파형 0 기준으로 위/아래로 치우쳐진 불균형 제거
    - High-Pass filter(HPF)
        - HPF_CUT 이하의 저주파 감쇠
        - 음성 주파수 대역 보존
    - 하이퍼 파라미터
        - HPF_CUT : HPT의 차단 주파수(cut_off)
            - 낮을수록 저역이 많이 남음
            - 높을수록 저역 노이즈 제거가 강화되지만, 남성 저음 등 발성 일부 손실 가능
            - 20~50kHz(default = 30)
        - FILTER_ORDER : Butterworth filter의 차수
            - 낮으면(1~2) 완만한 감쇠
            - 높으면(3~4) 급격한 감쇠
            - 1~4(default = 2)
        - SR : 샘플링 주파수
            - HPF_CUT과 비례 관계
            - Whisper 표준 16kHz
        - USE_DC_REMOVAL : DC 제거 수행 여부
            - True : 활성화
            - False : 비활성화
    - 파형 균형 잡기, 저주파 제거, 신호 대 잡음비(SNL) 향상
    - STFT, Mel, MFCC 사용에 안정적
 - Pre-emphasis
    - 고주파 증폭(강조), 저주파 약간 감쇠 역할
    - 현재 sample에서 이전 sample의 일부 x α를 빼주는 방식(고주파 증폭)
    - 저주파(0~1 kHz)는 거의 영향 없고, 고주파(3~7kHz)에 6~10dB 부스트
    - 하이퍼 파라미터
        - α(PREEMPH_COEFF) : 직전 샘플을 얼마나 뺄지 결정하는 필터 계수
            - 높을수록(0.97 ~ 0.99) 고주파 강조 저주파 감쇠 효과 증폭
            - 낮을수록(0.9 이하) 효과 약화, 원본 보존
            - 0.95 ~ 0.98(default = 0.97)
        - APPLYY_PREEMPH : pre-emphasis 수행 여부
            - True : 활성화
            - False : 비활성화
    - 스펙트럼에서 고주파 평탄화
    - MFCC 계산 시 log-spectrum 안정적
    - Whisper/Nemo의 경우 내부적으로 log-mel 자체 학습하여 생략해도 문제 없음
    - Inverse Pre-emphasis : 후처리에서 사용 가능
- VAD
    - 오디오 신호에서 무음/잡음/배경음의 제거/감쇠로 음성이 있는 구간만 검출
    - 과정
        - 프레임 분할
            - 입력된 오디오를 일정 길이의 프레임 단위로 분할
            - 프레임 당 에너지, 제로싱크로율(ZCR), 스펙트럼 엔트로피로 계산
        - 음성/비음성 판별
            - 위 특징들을 사용하여 분류
            - CNN, LSTM, TDNN 등의 스펙트럼 피처를 입력받아 확률 예측
        - 후처리
            - 너무 짧은 구간 제거
            - 인접한 짧은 음성 구간 병합
            - 앞/뒤로 약간의 padding으로 단어 끊김 방지
    - 하이퍼 파라미터
        - aggressiveness : 비음성 제거 강도
            - 높을수록 잡음 억제와 말 끝 손실 커짐
            - 0~3(default = 2)
        - frame_ms : 분할 할 frame 길이
            - 짧으면 세밀하고 많은 계산이 필요
            - 길면 안정적
            - 10, 20, 30
        - pad_ms : 음성 앞/뒤에 유지할 패딩 길이
            - 앞/뒤 발음 절단 방지
            - 0~200ms
        - min_speech_ms : 너무 짧은 구간 필터링
            - 50~150ms
        - crossfade_ms : 병합 시 부드러운 경계 처리
            - 5~15ms
        - energy_threshold : 단순 에너지 기준값
            - 신경망 미사용 시 사용
            - 30~50dBFS
    - 이후 작업에 불필요한 입력을 줄여 전사 정확도(WER) 및 화자 임베딩 품질(SNR) 개선

==================================================
# 전처리와 Whisper의 영향 판단

- Whisper의 경우 약 680,000 시간의 다양한 오디오를 학습하여 noise 환경의 오디오에 강함
- 노이즈 제거를 하면 경우에 따라 모델 성능이 오히려 나빠질 수 있다. - GitHub discussion

“Generally speaking, in speech recognition, de-noising rarely works.
 … the denoising modify the spectral representation of the audio
  … even when for human the speech sounds much more clear, 
  for the ASR the spectral representation is less resemble 
  the pattern of the expected audio.”
  
  "일반적으로 음성 인식에서 노이즈 제거는 거의 작동하지 않습니다.
   ... 노이즈 제거는 오디오의 스펙트럼 표현을 수정합니다
   ... 사람의 경우 음성이 훨씬 더 명확하게 들릴 때조차도 ASR의 경우 
   스펙트럼 표현이 예상되는 오디오 패턴과 덜 유사합니다."

- 큰 영향이 있을 가능성이 높은 전처리
    - 정규화(음량 균등화 / gain 조정)
        - 음성 레벨 조정, 가능하다면 피크 클리핑 없이 SNR 확보
    - VAD / 침묵 제거
        - 긴 침묵 / 잡음이 존재할 경우, 잘못도니 텍스트로 hallucination이 일어날 가능성이 높다.
        - 이 부분을 잘라내거나 segmentation하는 것이 인식률 향상에 도움이 될 수 있다.
    - 고주파 / 저주파 필터링(HPF/DC-offset 제거 등)
        - DC-offset이나 과한 저음/초고주파 노이즈가 스펙트럼 혼선 유발 가능
    - 채널 단일화 및 리샘플링
        - 16kHz, Mono
- 영향이 적거나 해로울 가능성이 있는 전처리
    - Noise reduction
        - 음성의 스펙트럼 특성을 왜곡해 인식 성능이 저하될 수 있다.
        - 사용할거면, 전후 비교를 통해 결정
    - Pre-emphasis, MFCC, CMVN 등의 복잡한 특징 추출
        - Whisper 내부에서 log-mel 특징 사용
        - 오히려 입력 포맷(리샘플링, 모노, waveform)을 벗어나 역효과가 일어날 가능성 있다.
    - crossfade, fade in/out, 복잡한 채널 믹싱
        - 유의미한 영향을 끼치지 않을것이다.
        - 후순위 작업


금일 진행 task
1. wav load(librosa) → 노이즈 감쇠(noisereduce) → 사람 소리 증폭(linear gain, 6dB) → 무음 제거(VAD, webrtcvad) → Log-Mel(librosa.feature.melspectogram())

aggr = 2 사용

2. 전처리_정확도 6에서 아래 7가지 변경

프레임 길이: frame_ms=20(기본 무난), 매우 섬세한 경계가 필요하면 10ms.

컨텍스트 패딩: VAD로 잘라내더라도 각 조각 앞뒤로 ±0.15~0.25s 패딩을 유지(붙이지 말고 세그먼트 단위 입력).

크로스페이드: 조각을 연결해야 한다면 5–15ms crossfade(클릭음/단절 방지).

노이즈 감쇠 강도: NR이 세면 실제 음성까지 약해져 VAD가 잘라버림 → prop_decrease를 0.05~0.1로 보수적 운용.

게인: VAD 전 RMS/peak 정렬(+3~6 dB)로 약발성 보존.

Whisper 옵션: 언어 고정, temperature fallback, word timestamps로 경계 유실 보정 용이.

검증 세트로 선택: 30~60분의 대표 샘플에 대해 mode=2/3 A/B 후 WER/CER, 길이 보존률, 문장 끝 누락율로 결정.

3. DC/HPF → VAD → GAIN 진행